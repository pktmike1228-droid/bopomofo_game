<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨éŸ³ç¬¦è™Ÿéš¨æ©Ÿè½è®€ç·´ç¿’ - æœ€çµ‚ç‰ˆ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f4f4f9;
            margin: 0;
            color: #333;
        }

        #game-container {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        #stats-container {
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #555;
            display: flex;
            justify-content: space-between;
            align-items: center; /* è®“æŒ‰éˆ•å’Œæ–‡å­—å°é½Š */
            padding: 0 10px;
        }

        #bopomofo-display {
            /* é è¨­å¤§å°åœ¨ JavaScript ä¸­è¨­å®š */
            font-weight: bold;
            margin: 40px 0;
            color: #e74c3c;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffebee;
            border-radius: 10px;
            line-height: 1; 
            /* éæ¸¡æ•ˆæœè®“å­—é«”å¤§å°è®ŠåŒ–æ›´å¹³æ»‘ */
            transition: font-size 0.3s, color 0.3s; 
        }

        #button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .action-button {
            padding: 15px 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            color: white;
            transition: background-color 0.2s, transform 0.1s;
        }

        #next-button {
            background-color: #3498db;
        }

        #next-button:hover {
            background-color: #2980b9;
        }
        
        #listen-button {
            background-color: #2ecc71;
        }

        #listen-button:hover {
            background-color: #27ae60;
        }
        
        #reset-button {
            background-color: #f39c12; 
        }
        
        #reset-button:hover {
            background-color: #e67e22;
        }


        .action-button:active {
            transform: scale(0.98);
        }

        #message {
            margin-top: 20px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>æ³¨éŸ³ç¬¦è™Ÿéš¨æ©Ÿè½è®€ç·´ç¿’ ğŸ’¡</h1>
        
        <div id="stats-container">
            <button id="reset-button" class="action-button" onclick="resetGame()">é‡æ–°é–‹å§‹ ğŸ”„</button>
            <div id="counter-display">å·²ç·´ç¿’é¡Œæ•¸: 0</div>
        </div>

        <div id="bopomofo-display">é»æ“Šä¸‹ä¸€é¡Œé–‹å§‹</div>

        <div id="button-group">
            <button id="next-button" class="action-button" onclick="startNewRound()">ä¸‹ä¸€é¡Œ</button>
            <button id="listen-button" class="action-button" onclick="playCurrentSound()" disabled>ğŸ‘‚ è½è½çœ‹</button>
        </div>
        
        <div id="message">è«‹é»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹ç·´ç¿’</div>

        <audio id="bopomofo-audio"></audio>
    </div>

    <script>
        // å…¨éƒ¨ 37 å€‹æ³¨éŸ³ç¬¦è™Ÿ
        const bopomofo = [
            "ã„…", "ã„†", "ã„‡", "ã„ˆ", "ã„‰", "ã„Š", "ã„‹", "ã„Œ", "ã„", "ã„", "ã„",
            "ã„", "ã„‘", "ã„’", "ã„“", "ã„”", "ã„•", "ã„–", "ã„—", "ã„˜", "ã„™",
            "ã„§", "ã„¨", "ã„©", "ã„š", "ã„›", "ã„œ", "ã„", "ã„", "ã„Ÿ", "ã„ ", "ã„¡",
            "ã„¢", "ã„£", "ã„¤", "ã„¥", "ã„¦"
        ];

        let currentSymbol = '';
        let roundCounter = 0; // é¡Œæ•¸è¨ˆæ¬¡å™¨

        // å–å¾— HTML å…ƒç´ 
        const displayEl = document.getElementById('bopomofo-display');
        const audioEl = document.getElementById('bopomofo-audio');
        const messageEl = document.getElementById('message');
        const listenButton = document.getElementById('listen-button');
        const counterDisplay = document.getElementById('counter-display');


        /**
         * ç”¢ç”Ÿ Google Text-to-Speech è²éŸ³é€£çµã€‚
         */
        function getSpeechUrl(text) {
            // Google Translate TTS æœå‹™
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=zh-TW&q=${encodeURIComponent(text)}`;
            return url;
        }

        /**
         * æ’­æ”¾ç•¶å‰æ³¨éŸ³ç¬¦è™Ÿçš„è²éŸ³ã€‚
         */
        function playCurrentSound() {
            if (!currentSymbol) {
                messageEl.textContent = 'è«‹å…ˆé»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚';
                return;
            }
            
            // 1. è¨­å®šéŸ³æº
            const speechUrl = getSpeechUrl(currentSymbol);
            audioEl.src = speechUrl;

            // 2. æš«åœç›®å‰çš„éŸ³æª”ï¼Œä¸¦å¾é ­é–‹å§‹
            audioEl.pause();
            audioEl.currentTime = 0;
            
            // 3. è¦–è¦ºå›é¥‹ï¼šæ­£åœ¨ç™¼éŸ³
            listenButton.textContent = 'ğŸ”Š æ­£åœ¨ç™¼éŸ³...';
            listenButton.disabled = true;

            // 4. æ’­æ”¾çµæŸå¾Œï¼Œæ¢å¾©æŒ‰éˆ•ç‹€æ…‹ä¸¦æ¸…é™¤ src
            audioEl.onended = function() {
                listenButton.textContent = 'ğŸ‘‚ è½è½çœ‹';
                listenButton.disabled = false;
                audioEl.removeAttribute('src'); 
            };
            
            // 5. å˜—è©¦æ’­æ”¾
            audioEl.play().catch(error => {
                messageEl.textContent = 'æ’­æ”¾è²éŸ³å¤±æ•—ï¼Œè«‹é»æ“Šã€Œä¸‹ä¸€é¡Œã€å†è©¦ä¸€æ¬¡ã€‚';
                listenButton.textContent = 'ğŸ‘‚ è½è½çœ‹';
                listenButton.disabled = false;
                audioEl.removeAttribute('src'); 
                console.error("æ’­æ”¾è²éŸ³å¤±æ•—ï¼š", error);
            });
        }

        /**
         * é–‹å§‹ä¸€è¼ªæ–°çš„éŠæˆ²ï¼ˆç”¢ç”Ÿæ–°é¡Œç›®ï¼‰
         */
        function startNewRound() {
            // 1. æ›´æ–°è¨ˆæ¬¡å™¨
            roundCounter++; 
            counterDisplay.textContent = `å·²ç·´ç¿’é¡Œæ•¸: ${roundCounter}`;

            // 2. éš¨æ©Ÿé¸å‡ºä¸€å€‹æ³¨éŸ³ç¬¦è™Ÿ
            currentSymbol = bopomofo[Math.floor(Math.random() * bopomofo.length)];
            displayEl.textContent = currentSymbol;
            
            // 3. åˆ‡æ›å›æ³¨éŸ³ç¬¦è™Ÿçš„å¤§å­—é«”å’Œé¡è‰²
            displayEl.style.fontSize = '15em'; 
            displayEl.style.color = '#e74c3c'; 

            // 4. ç¢ºä¿ audio å…ƒç´ æ²’æœ‰ src
            audioEl.removeAttribute('src');
            
            // 5. å•Ÿç”¨ã€Œè½è½çœ‹ã€æŒ‰éˆ•
            listenButton.disabled = false;
            listenButton.textContent = 'ğŸ‘‚ è½è½çœ‹';
            messageEl.textContent = `æ–°çš„æ³¨éŸ³ç¬¦è™Ÿï¼š${currentSymbol}ã€‚è«‹é»æ“Šã€Œè½è½çœ‹ã€ç™¼éŸ³ã€‚`;
        }
        
        /**
         * é‡æ–°é–‹å§‹éŠæˆ²ï¼Œé‡è¨­è¨ˆæ•¸å™¨ã€‚
         */
        function resetGame() {
            roundCounter = 0; // è¨ˆæ•¸å™¨æ­¸é›¶
            counterDisplay.textContent = `å·²ç·´ç¿’é¡Œæ•¸: 0`;
            currentSymbol = '';
            
            // ç•«é¢ç‹€æ…‹æ¢å¾©åˆå§‹
            displayEl.textContent = 'æº–å‚™å¥½äº†å—ï¼Ÿ';
            // é€™è£¡è¨­å®šåˆå§‹æ–‡å­—çš„å¤§å°å’Œé¡è‰²
            displayEl.style.fontSize = '3em'; 
            displayEl.style.color = '#7f8c8d'; 
            
            listenButton.disabled = true;
            listenButton.textContent = 'ğŸ‘‚ è½è½çœ‹';
            messageEl.textContent = 'è¨ˆæ•¸å·²æ­¸é›¶ã€‚è«‹é»æ“Šã€Œä¸‹ä¸€é¡Œã€é‡æ–°é–‹å§‹ç·´ç¿’ã€‚';
        }

        // é¦–æ¬¡è¼‰å…¥æ™‚çš„åˆå§‹åŒ–
        window.onload = function() {
            resetGame(); // ç¢ºä¿ä¸€é–‹å§‹å°±åŸ·è¡Œåˆå§‹åŒ–ç‹€æ…‹
        }
    </script>
</body>
</html>
